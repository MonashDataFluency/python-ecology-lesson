<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2018-03-21 16:23:59 +1100">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicon-dc.ico" />
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>Python for ecologists: Making Plots With ggplot</title>
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="http://datacarpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/dc-icon-black.svg" alt="Data Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../conduct/">Code of Conduct</a></li>

	
        
        <li><a href="../setup/">Setup</a></li>
        <li><a href="../reference/">Reference</a></li>
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../00-short-introduction-to-Python/">Programming in Python (Introduction)</a></li>
            
            <li><a href="../01-starting-with-data/">Data Analysis in Python</a></li>
            
            <li><a href="../02-index-slice-subset/">Indexing, Slicing and Subsetting DataFrames in Python</a></li>
            
            <li><a href="../03-data-types-and-format/">Data Types and Formats</a></li>
            
            <li><a href="../04-merging-data/">Combining DataFrames with Pandas</a></li>
            
            <li><a href="../05-loops/">Repeating Actions with Loops</a></li>
            
            <li><a href="../06-visualization-ggplot-python/">Making Plots With ggplot</a></li>
            
            <li><a href="../07-putting-it-all-together/">Data Ingest and Visualization - Matplotlib and Pandas</a></li>
            
            <li><a href="../08-working-with-sql/">Accessing SQLite Databases Using Python and Pandas</a></li>
            
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../about/">About</a></li>
            
            <li><a href="../discuss/">Discussion</a></li>
            
            <li><a href="../figures/">Figures</a></li>
            
            <li><a href="../guide/">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../license/">License</a></li>
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>





<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../05-loops/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
    <h3 class="maintitle"><a href="../">Python for ecologists</a></h3>
    <h1 class="maintitle">Making Plots With ggplot</h1>
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../07-putting-it-all-together/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 40 min
      <br/>
      <strong>Exercises:</strong> 50 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I visualize data in Python?</p>
</li>
	
	<li><p>What is ‘grammar of graphics’?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Familiarise yourself with The Gramma of Graphics through plotinine library</p>
</li>
	
	<li><p>Create a ggplot object.</p>
</li>
	
	<li><p>Explore different geom objects</p>
</li>
	
	<li><p>Explore other layers of ggplot, including themes and labels</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<h2 id="introduction">Introduction</h2>

<p>Python has powerful built-in plotting capabilities such as <a href="https://matplotlib.org/"><code class="highlighter-rouge">matplotlib</code></a>, but with great power comes great complexity. For this exercise, we are going to use different python library, <a href="https://plotnine.readthedocs.io/en/stable/"><code class="highlighter-rouge">plotnine</code></a>. There are a number of different libraries to choose from, but we are setting on <a href="https://plotnine.readthedocs.io/en/stable"><code class="highlighter-rouge">plotnine</code></a> as this is python port of original <a href="http://ggplot2.org/"><code class="highlighter-rouge">ggplot2</code></a> an R library (package), which is a very nice way to create publication quality plots and syntax is preserved, meaning you can take your python ggplot code and run it in R if you want it.
Strictly speaking <a href="https://plotnine.readthedocs.io/en/stable/"><code class="highlighter-rouge">plotnine</code></a> is just another implementation of <a href="http://link.springer.com/book/10.1007%2F0-387-28695-0">The Grammar of Graphics</a> by Leland Wilkinson, which in theory could go on it own direction and diverge away from an R <code class="highlighter-rouge">ggplot</code> .</p>

<h4 id="the-grammar-of-graphics">The Grammar of Graphics</h4>

<blockquote>
  <p>statistical graphic is a mapping from data to aesthetic attributes (colour, shape, size) of geometric objects (points, lines, bars)
Faceting can be used to generate the same plot for different subsets of the dataset</p>
</blockquote>

<p>These are basic building blocks according to the grammar of graphics:</p>

<ul>
  <li><strong>data</strong> The data + a set of aesthetic mappings that describing variables mapping</li>
  <li><strong>geom</strong> Geometric objects, represent what you actually see on the plot: points, lines, polygons, etc.</li>
  <li><strong>stats</strong> Statistical transformations, summarise data in many useful ways.</li>
  <li><strong>scale</strong> The scales map values in the data space to values in an aesthetic space</li>
  <li><strong>coord</strong> A coordinate system, describes how data coordinates are mapped to the plane of the graphic.</li>
  <li><strong>facet</strong> A faceting specification describes how to break up the data into subsets for plotting individual set</li>
</ul>

<p>Let’s explore those in details</p>

<h1 id="plotting-in-ggplot-style">Plotting in ggplot style</h1>

<p>Let set up our working environment with necessary libraries and also load our csv file into data frame called <code class="highlighter-rouge">survs_df</code>,</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">plotnine</span> <span class="kn">import</span> <span class="o">*</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">survs_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'data/surveys.csv'</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</code></pre></div></div>

<p>Producing a plot with ggplot, we must give three things:</p>

<ol>
  <li>A data frame containing our data.</li>
  <li>How the columns of the data frame can be translated into positions, colors, sizes, and shapes of graphical elements (“aesthetics”).</li>
  <li>The actual graphical elements to display (“geometric objects”).</li>
</ol>

<h2 id="introduction-to-plotting">Introduction to plotting</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'weight'</span><span class="p">,</span> <span class="s">'hindfoot_length'</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span>
</code></pre></div></div>

<p>Lets see if we can also include information about species and year</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'weight'</span><span class="p">,</span> <span class="s">'hindfoot_length'</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="s">'year'</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'weight'</span><span class="p">,</span> <span class="s">'hindfoot_length'</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="s">'year'</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'species_id'</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span>
</code></pre></div></div>

<p>We can do simple counting plot, to see how many observation (data points) we have for each year for example</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year'</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span> <span class="o">=</span> <span class="s">'count'</span><span class="p">)</span>
</code></pre></div></div>

<p>Let’s now also color by species to see how many observation we have per species in a given year</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="s">'species_id'</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span> <span class="o">=</span> <span class="s">'count'</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="challenges">Challenges</h2>

<blockquote>
  <p>Is there a better visualisation for comparing weight across years? The plot should have categorical data on x axis and continuous on y axis
Plot a boxplot of <code class="highlighter-rouge">hindfoot_length</code> across different species (<code class="highlighter-rouge">species_id</code> column)</p>
</blockquote>

<h2 id="more-geom-types">More geom types</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'weight'</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">geom_boxplot</span><span class="p">()</span>
</code></pre></div></div>

<p>Why are we not seeing mulitple boxplots, one for each year?
This is because year variable is continues in our data frame, but for the purpose we want it to be categorical.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">survs_df</span><span class="p">[</span><span class="s">'year_fact'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">survs_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s">"category"</span><span class="p">)</span>

<span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year_fact'</span><span class="p">,</span> <span class="s">'weight'</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">geom_boxplot</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year_fact'</span><span class="p">,</span> <span class="s">'weight'</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">geom_violin</span><span class="p">()</span>
</code></pre></div></div>

<p>To save an image for later</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt1</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year_fact'</span><span class="p">,</span> <span class="s">'weight'</span><span class="p">))</span> <span class="o">+</span> \
           <span class="n">geom_boxplot</span><span class="p">()</span> <span class="o">+</span> \
           <span class="n">xlab</span><span class="p">(</span><span class="s">"Years"</span><span class="p">)</span> <span class="o">+</span> \
           <span class="n">ylab</span><span class="p">(</span><span class="s">"Weight log2(kg)"</span><span class="p">)</span> <span class="o">+</span> \
           <span class="n">ggtitle</span><span class="p">(</span><span class="s">"Boxplots, summary of species wieght in each year"</span><span class="p">)</span>

<span class="n">ggsave</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="s">"plot1.png"</span><span class="p">,</span> \
       <span class="n">plot</span> <span class="o">=</span> <span class="n">plt1</span><span class="p">,</span> \
       <span class="n">device</span> <span class="o">=</span> <span class="s">'png'</span><span class="p">,</span> \
       <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> \
       <span class="n">height</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span> \
        <span class="n">width</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="challenges-1">Challenges</h2>

<blockquote>
  <p>Can you log2 transform <code class="highlighter-rouge">weight</code> and plot “normalised” boxplot. Hint: use <code class="highlighter-rouge">np.log2()</code> function and name new column <code class="highlighter-rouge">weight_log</code></p>
</blockquote>

<p>Also will log2 transforming make this data visualisation better?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">survs_df</span><span class="p">[</span><span class="s">'weight_log'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">survs_df</span><span class="p">[</span><span class="s">'weight'</span><span class="p">])</span>
    
<span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year_fact'</span><span class="p">,</span> <span class="s">'weight_log'</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">geom_boxplot</span><span class="p">()</span> <span class="o">+</span> \
    <span class="n">xlab</span><span class="p">(</span><span class="s">"Years"</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">ylab</span><span class="p">(</span><span class="s">"Weight log2(kg)"</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">ggtitle</span><span class="p">(</span><span class="s">"Boxplots, summary of species wieght in each year"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="faceting">Faceting</h2>

<p>ggplot has a special technique called <em>faceting</em> that allows to split one plot
into multiple plots based on a factor included in the dataset. We will use it to
make one plot for a time series for each species.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year_fact'</span><span class="p">,</span> <span class="s">'weight'</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">geom_boxplot</span><span class="p">()</span> <span class="o">+</span> \
    <span class="n">facet_wrap</span><span class="p">(</span><span class="s">"~sex"</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year_fact'</span><span class="p">,</span> <span class="s">'weight_log'</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">geom_boxplot</span><span class="p">()</span> <span class="o">+</span> \
    <span class="n">theme</span><span class="p">(</span><span class="n">axis_text_x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">facet_wrap</span><span class="p">(</span><span class="s">"~species_id"</span><span class="p">)</span> 
</code></pre></div></div>

<h2 id="theming">Theming</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year_fact'</span><span class="p">,</span> <span class="s">'weight'</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">geom_boxplot</span><span class="p">()</span> <span class="o">+</span> \
    <span class="n">theme_bw</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year_fact'</span><span class="p">,</span> <span class="s">'weight_log'</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">geom_boxplot</span><span class="p">()</span> <span class="o">+</span> \
    <span class="n">theme</span><span class="p">(</span><span class="n">axis_text_x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">facet_wrap</span><span class="p">(</span><span class="s">"~species_id"</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">theme_xkcd</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="extra-bits-1">Extra bits 1</h2>

<p>Let’s try to bin years into decades, which could be crude but might gives simple images to look at.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bins</span> <span class="o">=</span> <span class="p">[(</span><span class="n">survs_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1980</span><span class="p">),</span>
        <span class="p">(</span><span class="n">survs_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">1990</span><span class="p">),</span>
        <span class="p">(</span><span class="n">survs_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2000</span><span class="p">),</span>
        <span class="p">(</span><span class="n">survs_df</span><span class="p">[</span><span class="s">'year'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2000</span><span class="p">)]</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">'70s'</span><span class="p">,</span> <span class="s">'80s'</span><span class="p">,</span> <span class="s">'90s'</span><span class="p">,</span> <span class="s">'Z'</span><span class="p">]</span>

<span class="n">survs_df</span><span class="p">[</span><span class="s">'year_bins'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt2</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year_bins'</span><span class="p">,</span> <span class="s">'weight_log'</span><span class="p">))</span> <span class="o">+</span> \
           <span class="n">geom_boxplot</span><span class="p">()</span>
<span class="n">plt2</span> 
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt2</span> <span class="o">=</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year_bins'</span><span class="p">,</span> <span class="s">'weight_log'</span><span class="p">))</span> <span class="o">+</span> \
           <span class="n">geom_boxplot</span><span class="p">()</span> <span class="o">+</span> \
           <span class="n">theme</span><span class="p">(</span><span class="n">axis_text_x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> \
           <span class="n">facet_wrap</span><span class="p">(</span><span class="s">"~species_id"</span><span class="p">)</span> 
<span class="n">plt2</span> 
</code></pre></div></div>

<h2 id="extra-bits-2">Extra bits 2</h2>

<p>This is a different way to look at your data</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">"year_fact"</span><span class="p">,</span> <span class="s">"weight"</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">stat_summary</span><span class="p">(</span><span class="n">fun_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">fun_ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="nb">min</span><span class="p">,</span> <span class="n">fun_ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="nb">max</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">theme</span><span class="p">(</span><span class="n">axis_text_x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>
    
<span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">"year_fact"</span><span class="p">,</span> <span class="s">"weight"</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">stat_summary</span><span class="p">(</span><span class="n">fun_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">,</span> <span class="n">fun_ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="nb">min</span><span class="p">,</span> <span class="n">fun_ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="nb">max</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">theme</span><span class="p">(</span><span class="n">axis_text_x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>
    
<span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">"year_fact"</span><span class="p">,</span> <span class="s">"weight_log"</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">stat_summary</span><span class="p">(</span><span class="n">fun_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">fun_ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="nb">min</span><span class="p">,</span> <span class="n">fun_ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="nb">max</span><span class="p">)</span> <span class="o">+</span> \
    <span class="n">theme</span><span class="p">(</span><span class="n">axis_text_x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="extra-bits-3">Extra bits 3</h2>

<p>It is very informative to look across years, year by year, it becomes apparent straight away that for some species there is a lot of data is missing.And going forward, maybe, you’d want to filter those low counting species. (this is after faceting by <code class="highlighter-rouge">species_id</code> in section <a href="#extra-bits-1">Extra bits 1</a>).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#survs_cnts_df = survs_df.groupby(['species_id'], as_index=False).count().sort_values(['record_id'])</span>
<span class="n">survs_cnts_df</span> <span class="o">=</span> <span class="n">survs_df</span><span class="p">[[</span><span class="s">'species_id'</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">'species_id'</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">species_to_remove</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">survs_cnts_df</span><span class="p">[</span><span class="n">survs_cnts_df</span><span class="p">[</span><span class="s">'record_id'</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">]</span><span class="o">.</span><span class="n">species_id</span><span class="p">)</span>
<span class="n">survs_df_filt</span> <span class="o">=</span> <span class="n">survs_df</span><span class="p">[</span><span class="n">survs_df</span><span class="p">[</span><span class="s">'species_id'</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">species_to_remove</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df_filt</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year_fact'</span><span class="p">,</span> <span class="s">'weight_log'</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">geom_boxplot</span><span class="p">()</span> <span class="o">+</span> \
    <span class="n">theme</span><span class="p">(</span><span class="n">axis_text_x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">ggplot</span><span class="p">(</span><span class="n">survs_df_filt</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">'year_fact'</span><span class="p">,</span> <span class="s">'weight_log'</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">geom_boxplot</span><span class="p">()</span> <span class="o">+</span> \
    <span class="n">theme</span><span class="p">(</span><span class="n">axis_text_x</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">angle</span> <span class="o">=</span> <span class="mi">90</span><span class="p">,</span> <span class="n">hjust</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> \
    <span class="n">facet_wrap</span><span class="p">(</span><span class="s">"~species_id"</span><span class="p">)</span> 
</code></pre></div></div>

<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>plotnine is python implementation of The Gramma of Graphics</p>
</li>
    
    <li><p>ggplot is a set of gramma rules to make publication quality plots</p>
</li>
    
    <li><p>ggplot has idea of layer, building a plot is just adding different layers together</p>
</li>
    
  </ul>
</blockquote>





<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../05-loops/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../07-putting-it-all-together/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      <footer>
  <div class="row">
    <div class="col-md-6" align="left">
      <h4>
	Copyright &copy; 2016
	
	<a href="http://datacarpentry.org">Data Carpentry</a>
	
      </h4>
    </div>
    <div class="col-md-6" align="right">
      <h4>
	<a href="/">Source</a>
	/
	<a href="/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="/blob/gh-pages/CITATION">Cite</a>
	/
	<a href="">Contact</a>
      </h4>
    </div>
  </div>
</footer>

      
    </div>
    <script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>
  </body>
</html>
